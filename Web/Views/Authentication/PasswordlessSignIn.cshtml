@model Web.Models.PasswordlessSignUpModel

<header>
    <h1>Sign in</h1>
    @await Component.InvokeAsync("NavBar")
</header>

<main hx-disable>
    <form id="passwordlessSignInForm" method="post">
        <input
            type="text"
            name="username"
            placeholder="Username"
            aria-label="Username"
            autoComplete="username"
            required/>
        <button type="submit">
            Login
        </button>
    </form>
</main>

@section Scripts
{
    <script type="module">
      import { Client } from 'https://cdn.passwordless.dev/dist/1.1.0/esm/passwordless.min.mjs';
        
      document.getElementById('passwordlessSignInForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          const username = e.target.querySelector('input[name="username"]').value
          
          const p = new Client({
            apiKey: '@Model.PublicKey'
          });
          
          const { token, error } = await p.signinWithAlias(username);
          // Tip: You can also try p.signinWithDiscoverable();
          
          const response = await fetch(`@Url.Action("PasswordlessSignInWebAuthn", "Authentication")?token=${token}`);
          const body = await response.json();
          
          if (body.success) {
              // redirect home
          }
      });
    </script>
}
